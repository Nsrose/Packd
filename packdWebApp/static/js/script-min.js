function distance(e,t,n,r){var i=6371;var s=(r-t).toRad();var o=(n-e).toRad();var u=Math.sin(s/2)*Math.sin(s/2)+Math.cos(t.toRad())*Math.cos(r.toRad())*Math.sin(o/2)*Math.sin(o/2);var a=2*Math.atan2(Math.sqrt(u),Math.sqrt(1-u));var f=i*a;return f}function checkLoadFactor(e,t,n){var r=e.child("Size").val();if(r>LOAD_FACTOR){fireRef.update({Locked:true});refactor(e)}else{var i=e.child("-JgOwwFlFThZOqBMUnP0").child(t).child(n).child("current_average").child("measure").val();if(i==null){$("#data").text(closedMessage)}else{$("#data").text(i)}}}function refactor(e){var t=e.child("-JgOwwFlFThZOqBMUnP0").val();for(var n in t){for(var r in t[n]){var i=t[n][r];var s=getDenom(i);var o=0;for(var u in i){var a=weight(i[u]["measure"]);var f=i[u]["weight"];o+=a*(f/s)}var l=ints_to_strings[Math.round(o)];var c=s;var h="https://packd.firebaseio.com/-JgOwwFlFThZOqBMUnP0/"+n+"/"+r;var p=new Firebase(h);p.set({current_average:{measure:l,weight:c}})}}fireRef.update({Locked:false});fireRef.update({Size:0});var d=e.child("-JgOwwFlFThZOqBMUnP0").child(n).child(r).child("current_average").child("measure").val();if(d==null){$("#data").text(closedMessage)}else{$("#data").text(d)}}function getDenom(e){var t=0;for(var n in e){var r=e[n];t+=r["weight"]}return t}function weight(e){return strings_to_ints[e]}var days={0:"Sunday",1:"Monday",2:"Tuesday",3:"Wednesday",4:"Thursday",5:"Friday",6:"Saturday"};var ints_to_strings={1:"Not Crowded",2:"Mildly Crowded",3:"Very Crowded",4:"Extreme"};var strings_to_ints={"Not Crowded":1,"Mildly Crowded":2,"Very Crowded":3,Extreme:4};var fireRef=new Firebase("https://packd.firebaseio.com/");var closedMessage="RSF is Closed";var RSF_LAT=37.868578;var RSF_LONG=-122.262812;var LOAD_FACTOR=200;var ALLOWED_RADIUS=.09;if(typeof Number.prototype.toRad==="undefined"){Number.prototype.toRad=function(){return this*Math.PI/180}}$(document).ready(function(){function s(t){if(navigator.geolocation){var n=t.coords.latitude;var s=t.coords.longitude;var o=distance(s,n,RSF_LONG,RSF_LAT);if(o>ALLOWED_RADIUS){alert("You aren't actually at the RSF.")}else{var u=null;for(var a=1;a<5;a++){var f="radio"+a;if(document.getElementById(f).checked){u=$("#"+f).val()}}fireRef.once("value",function(e){var t=e.child("Size").val();t+=1;fireRef.update({Size:t})});var l=fireRef.child("-JgOwwFlFThZOqBMUnP0");var c={measure:u,weight:1};l.child(i).child(r).push(c);e=true}}else{alert("Location services not working")}}var e=false;var t=new Date;var n=t.getDay();var r=t.getHours()*100;var i=days[n];fireRef.once("value",function(e){var t=null;var n=e.child("Locked").val();if(!n){checkLoadFactor(e,i,r)}else{t=e.child(i).child(r).val();if(t==null){$("#data").text(closedMessage)}else{$("#data_container").css("background-color",theColor);$("#title_container").css("background-color",theColor);$("#data").text(t)}}},function(e){var t="Either the RSF is closed, or something went wrong.";$("#data").text(t)});$("#send_data_submit").click(function(){if(!e){navigator.geolocation.getCurrentPosition(s)}else{alert("Thanks, we got it!")}})})